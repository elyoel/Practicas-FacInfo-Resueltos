;Parte A
EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H
N_TIMER EQU 11
CONT EQU 10H
COMP EQU 11h
ORG 1000h
  MSJ DB "Vamos a las interupciones", 10
  FIN DB ?

ORG 44
IP_TIMER DW RUT_TIMER

ORG 3000H  
RUT_TIMER: PUSH AX
  CALL IMPRIMIR
  IN AL, COMP
  ADD AL, 2
  OUT COMP, AL
  MOV AL, EOI
  OUT EOI, AL;
  POP AX
IRET
 
ORG 3200h
CONFIG_PIO: PUSH AX
  CLI
  MOV AL, 11111101b
  OUT IMR, AL;
  MOV AL, N_TIMER
  OUT INT1, AL;
  STI
  POP AX
  RET

CONFIG_TIMER: PUSH AX
  MOV AL, 0
  OUT CONT, AL
  MOV AL, 2
  OUT COMP, AL
  POP AX
RET

ORG 3300h
IMPRIMIR: PUSH BX
  PUSH AX
  MOV BX, offset MSJ
  MOV AL, Offset FIN - offset MSj
  INT 7
  POP AX
  POP BX
  RET

ORG 2000H
  CALL CONFIG_PIO
  CALL CONFIG_TIMER

LAZO: JMP LAZO
INT 0
END

;Parte B
EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H
N_TIMER EQU 11
CONT EQU 10H
COMP EQU 11h

ORG 1000h
  MSJ DB "Vamos a las interupciones", 10
  MSJ_FIN DB ?

ORG 44
IP_TIMER DW RUT_TIMER

ORG 3000H  
RUT_TIMER: PUSH AX
  IN AL, COMP
  CMP AL, 0Ah
  JNZ SALTO
  CALL OFF_TIMER
  
SALTO: CALL IMPRIMIR
  ADD AL, 2
  OUT COMP, AL
  MOV AL, EOI
  OUT EOI, AL;
  POP AX
IRET
 
ORG 3200h
CONFIG_PIO:
  PUSH AX
  MOV AL, 0FCH
  OUT IMR, AL
  MOV AL, N_TIMER
  OUT INT1, AL
  POP AX
  RET

CONFIG_TIMER:
  PUSH AX
  MOV AL, 0
  OUT CONT, AL
  MOV AL, 2
  OUT COMP, AL
  POP AX
RET

ORG 3300h
IMPRIMIR: PUSH BX
  PUSH AX
  MOV BX, offset MSJ
  MOV AL, Offset MSJ_FIN - offset MSj
  INT 7
  POP AX
  POP BX
  RET
OFF_TIMER: CLI
  PUSH AX
  MOV AL, 0FFh
  OUT IMR, AL
  POP AX
  STI
  RET

ORG 2000H
  CLI
  CALL CONFIG_PIO
  CALL CONFIG_TIMER
  STI
  MOV AH, 10
LAZO: IN AL, COMP
  CMP AH, AL
  JNS LAZO
INT 0
END

;Parte C
;Parte B
EOI EQU 20H
IMR EQU 21H
INT1 EQU 25H
N_TIMER EQU 11
CONT EQU 10H
COMP EQU 11h

ORG 1000h
  MSJ DB "Vamos a las interupciones", 10
  MSJ_FIN DB ?

ORG 44
IP_TIMER DW RUT_TIMER

ORG 3000H  
RUT_TIMER: PUSH AX
  PUSH BX
  CALL IMPRIMIR
  IN AL, COMP
  INC AL
  OUT COMP, AL
  IN AL, CONT
  MOV AL, 0
  OUT CONT, AL

  MOV AL, EOI
  OUT EOI, AL;
  POP BX
  POP AX
IRET
 
ORG 3200h
CONFIG_PIO:
  PUSH AX
  MOV AL, 11111101b
  OUT IMR, AL
  MOV AL, N_TIMER
  OUT INT1, AL
  POP AX
  RET

CONFIG_TIMER:
  PUSH AX
  MOV AL, 0
  OUT CONT, AL
  MOV AL, 1
  OUT COMP, AL
  POP AX
RET

ORG 3300h
IMPRIMIR: PUSH BX
  PUSH AX
  MOV BX, offset MSJ
  MOV AL, Offset MSJ_FIN - offset MSj
  INT 7
  POP AX
  POP BX
  RET
OFF_TIMER: CLI
  PUSH AX
  MOV AL, 0FFh
  OUT IMR, AL
  POP AX
  STI
  RET

ORG 2000H
  CLI
  CALL CONFIG_PIO
  CALL CONFIG_TIMER
  STI
  MOV AH, 255
LAZO: IN AL, COMP
  CMP AH, AL
  JS LAZO
INT 0
END


